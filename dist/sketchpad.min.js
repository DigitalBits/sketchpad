!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.module=e():t.module=e()}(this,function(){return function(t){function e(i){if(n[i])return n[i].exports;var s=n[i]={exports:{},id:i,loaded:!1};return t[i].call(s.exports,s,s.exports,e),s.loaded=!0,s.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e){"use strict";function n(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o=function(){function t(e){var n=this;return i(this,t),e.canvas=e.canvas||e.element,e.canvas?("string"==typeof e.canvas&&(e.canvas=document.querySelector(e.canvas)),this.canvas=e.canvas,["width","height","color","penSize","readOnly"].forEach(function(t){n[t]=e[t]||n.canvas.getAttribute("data-"+t)},this),this.width=this.width||0,this.height=this.height||0,this.color=this.color||"#000",this.penSize=this.penSize||5,this.readOnly=this.readOnly||!1,this.strokes=e.strokes?this._strokesFormat(e.strokes):[],this.undoHistory=e.undoHistory||[],this.onMouseMove=this.onMouseMove.bind(this),this.canvas.style.cursor="crosshair",this.events={},this.events.mousemove=[],this.internalEvents=["MouseDown","MouseUp","MouseOut","DrawEnd"],this.internalEvents.forEach(function(t){var e=t.toLowerCase();n.events[e]=[],n["on"+t]=n["on"+t].bind(n),n.canvas.addEventListener(e,function(){for(var t=arguments.length,i=Array(t),s=0;s<t;s++)i[s]=arguments[s];return n.trigger(e,i)})},this),void this.reset()):void console.error("[SKETCHPAD]: Please provide an element/canvas:")}return s(t,[{key:"_position",value:function(t){var e=t.offsetX,n=t.offsetY;return[e,n]}},{key:"_stroke",value:function(t){var e=this;return"clear"===t.type?this.context.clearRect(0,0,this.canvas.width,this.canvas.height):void t.lines.forEach(function(n){e._line(n[0],n[1],t.color,t.size)},this)}},{key:"_draw",value:function(t,e,n,i){this._line(t,e,n,i,"source-over")}},{key:"_erase",value:function(t,e,n,i){this._line(t,e,n,i,"destination-out")}},{key:"_line",value:function(t,e,n,i,s){this.context.save(),this.context.lineJoin="round",this.context.lineCap="round",this.context.strokeStyle=n,this.context.lineWidth=i,this.context.globalCompositeOperation=s,this.context.beginPath(),this.context.moveTo(t[0],t[1]),this.context.lineTo(e[0],e[1]),this.context.closePath(),this.context.stroke(),this.context.restore()}},{key:"_lineToString",value:function(t,e){var n="M"+t[0]+","+t[1]+"L"+e[0]+","+e[1];return n}},{key:"_lineToArray",value:function(t){var e=[],n=t.split("M");return n.splice(0,1),n.forEach(function(t){var n=t.split("L"),i=n.map(function(t){return t.split(",")});e.push(i)}),e}},{key:"_strokesFormat",value:function(t){var e=this,n=t.map(function(t){return t.lines=e._lineToArray(t.lines),t});return n}},{key:"onMouseDown",value:function(t){this._sketching=!0,this._lastPosition=this._position(t),this._currentStroke={color:this.color,size:this.penSize,current:!0,lines:[]},this.canvas.addEventListener("mousemove",this.onMouseMove)}},{key:"onMouseUp",value:function(t){this._sketching&&this._currentStroke.lines.length&&(this.strokes.push(this._currentStroke),this._sketching=!1,this.dispatch("drawend",{})),this.canvas.removeEventListener("mousemove",this.onMouseMove)}},{key:"onMouseOut",value:function(t){this.onMouseUp(t)}},{key:"onMouseMove",value:function(t){var e=this._position(t);this._draw(this._lastPosition,e,this.color,this.penSize),this._currentStroke.lines.push([this._lastPosition,e]),this._lastPosition=e,this.trigger("mousemove",[t])}},{key:"onDrawEnd",value:function(){}},{key:"toObject",value:function(){return{width:this.canvas.width,height:this.canvas.height,strokes:this.strokes,undoHistory:this.undoHistory}}},{key:"toJSON",value:function(){var t=this,e=JSON.parse(JSON.stringify(this.toObject()));return e.strokes=e.strokes.filter(function(t){return t.current}).map(function(e){var n="";return!!e.lines&&(e.lines.forEach(function(e){n+=t._lineToString(e[0],e[1])}),e.lines=n,e)}),e}},{key:"redo",value:function(){var t=this.undoHistory.pop();t&&(this.strokes.push(t),this._stroke(t)),this.dispatch("drawend",{})}},{key:"undo",value:function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height);var t=this.strokes.pop();this.redraw(),t&&this.undoHistory.push(t),this.dispatch("drawend",{})}},{key:"toImage",value:function(t){var e=new Image,n=this.canvas;return e.src=n.toDataURL("image/png"),e}},{key:"clear",value:function(){this.strokes.push({type:"clear"}),this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.dispatch("drawend",{})}},{key:"redraw",value:function(){var t=this;this.strokes.forEach(function(e){t._stroke(e)},this),this.dispatch("drawend",{})}},{key:"reset",value:function(){var t=this;this.canvas.width=this.width,this.canvas.height=this.height,this.context=this.canvas.getContext("2d"),this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.redraw(),this.internalEvents.forEach(function(e){return t.off(e.toLowerCase())}),this.readOnly||this.internalEvents.forEach(function(e){return t.on(e.toLowerCase(),t["on"+e])})}},{key:"cancelAnimation",value:function(){this.animateIds=this.animateIds||[],this.animateIds.forEach(function(t){clearTimeout(t)}),this.animateIds=[]}},{key:"animate",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,e=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=t;this.cancelAnimation(),this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.strokes.forEach(function(n){return"clear"===n.type?(s+=t,e.animateIds.push(setTimeout(function(){e.context.clearRect(0,0,e.canvas.width,e.canvas.height)},s))):void n.lines.forEach(function(i){s+=t,e.animateIds.push(setTimeout(function(){e._draw(i.start,i.end,n.color,n.size)},s))})}),n&&this.animateIds.push(setTimeout(function(){e.animate(t=10,n,i)},s+t+i)),this.animateIds(setTimeout(function(){e.trigger("animation-end",[t,n,i])},s+t))}},{key:"on",value:function(t,e){return void 0===this.events[t]?console.error("Sketchpad: No such action '"+t+"'"):void this.events[t].push(e)}},{key:"off",value:function(t,e){if(e){var n=this.events[t].indexOf(e);return n!==-1&&this.events[t].splice(n,1),n!==-1}this.events[t]=[]}},{key:"trigger",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.events[t].forEach(function(t){t.apply(void 0,n(e))})}},{key:"dispatch",value:function(t,e){var n=this.events[t];if(!n)throw new Error;for(var i=0;i<n.length;i++)n[i].apply(this,[this,e])}}]),t}();window.Sketchpad=o,t.exports=o}])});