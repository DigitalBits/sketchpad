!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.module=e():t.module=e()}(this,function(){return function(t){function e(n){if(i[n])return i[n].exports;var s=i[n]={exports:{},id:n,loaded:!1};return t[n].call(s.exports,s,s.exports,e),s.loaded=!0,s.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e){"use strict";function i(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),o=function(){function t(e){var i=this;return n(this,t),e.canvas=e.canvas||e.element,e.canvas?("string"==typeof e.canvas&&(e.canvas=document.querySelector(e.canvas)),this.canvas=e.canvas,["width","height","color","penSize","readOnly","disable"].forEach(function(t){i[t]=e[t]||i.canvas.getAttribute("data-"+t)},this),this.width=this.width||0,this.height=this.height||0,this.color=this.color||"#000",this.penSize=this.penSize||5,this.readOnly=this.readOnly||!1,this.disable=this.disable||!1,this.strokes=e.strokes?this._strokesFormat(e.strokes):[],this.undoHistory=e.undoHistory||[],this.onMouseMove=this.onMouseMove.bind(this),this.disable||(this.canvas.style.cursor="crosshair"),this.events={},this.events.mousemove=[],this.internalEvents=["MouseDown","MouseUp","MouseOut","DrawEnd"],this.internalEvents.forEach(function(t){var e=t.toLowerCase();i.events[e]=[],i["on"+t]=i["on"+t].bind(i),i.disable||i.canvas.addEventListener(e,function(){for(var t=arguments.length,n=Array(t),s=0;s<t;s++)n[s]=arguments[s];return i.trigger(e,n)})},this),void this.reset()):void console.error("[SKETCHPAD]: Please provide an element/canvas:")}return s(t,[{key:"_position",value:function(t){var e=t.offsetX,i=t.offsetY;return[e,i]}},{key:"_stroke",value:function(t){var e=this;return"clear"===t.type?this.context.clearRect(0,0,this.canvas.width,this.canvas.height):void t.lines.forEach(function(i){e._line(i[0],i[1],t.color,t.size)},this)}},{key:"_draw",value:function(t,e,i,n){this._line(t,e,i,n,"source-over")}},{key:"_erase",value:function(t,e,i,n){this._line(t,e,i,n,"destination-out")}},{key:"_line",value:function(t,e,i,n,s){this.context.save(),this.context.lineJoin="round",this.context.lineCap="round",this.context.strokeStyle=i,this.context.lineWidth=n,this.context.globalCompositeOperation=s,this.context.beginPath(),this.context.moveTo(t[0],t[1]),this.context.lineTo(e[0],e[1]),this.context.closePath(),this.context.stroke(),this.context.restore()}},{key:"_lineToString",value:function(t,e){var i="M"+t[0]+","+t[1]+"L"+e[0]+","+e[1];return i}},{key:"_lineToArray",value:function(t){var e=[],i=t.split("M");return i.splice(0,1),i.forEach(function(t){var i=t.split("L"),n=i.map(function(t){return t.split(",")});e.push(n)}),e}},{key:"_strokesFormat",value:function(t){var e=this,i=t.map(function(t){return"string"==typeof t.lines&&(t.lines=e._lineToArray(t.lines)),t});return i}},{key:"onDrawEnd",value:function(t){}},{key:"onMouseDown",value:function(t){this._sketching=!0,this._lastPosition=this._position(t),this._currentStroke={color:this.color,size:this.penSize,current:!0,lines:[]},this.canvas.addEventListener("mousemove",this.onMouseMove)}},{key:"onMouseUp",value:function(t){this._sketching&&this._currentStroke.lines.length&&(this.strokes.push(this._currentStroke),this._sketching=!1,this.dispatch("drawend",{})),this.canvas.removeEventListener("mousemove",this.onMouseMove)}},{key:"onMouseOut",value:function(t){this.onMouseUp(t)}},{key:"onMouseMove",value:function(t){var e=this._position(t);this._draw(this._lastPosition,e,this.color,this.penSize),this._currentStroke.lines.push([this._lastPosition,e]),this._lastPosition=e,this.trigger("mousemove",[t])}},{key:"toObject",value:function(){return{width:this.canvas.width,height:this.canvas.height,strokes:this.strokes,undoHistory:this.undoHistory}}},{key:"toJSON",value:function(){var t=this,e=JSON.parse(JSON.stringify(this.toObject()));return e.strokes=e.strokes.filter(function(t){return t.current}).map(function(e){var i="";return!!e.lines&&(e.lines.forEach(function(e){i+=t._lineToString(e[0],e[1])}),e.lines=i,e)}),e}},{key:"redo",value:function(){var t=this.undoHistory.pop();t&&(this.strokes.push(t),this._stroke(t)),this.dispatch("drawend",{})}},{key:"undo",value:function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height);var t=this.strokes.pop();this.redraw(),t&&this.undoHistory.push(t)}},{key:"toImage",value:function(t){var e=new Image,i=this.canvas;return e.src=i.toDataURL("image/png"),e}},{key:"clear",value:function(){this.strokes.push({type:"clear"}),this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.dispatch("drawend",{})}},{key:"redraw",value:function(){var t=this;this.strokes.forEach(function(e){t._stroke(e)},this),this.dispatch("drawend",{})}},{key:"reset",value:function(){var t=this;this.canvas.width=this.width,this.canvas.height=this.height,this.context=this.canvas.getContext("2d"),this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.redraw(),this.internalEvents.forEach(function(e){return t.off(e.toLowerCase())}),this.readOnly||this.internalEvents.forEach(function(e){return t.on(e.toLowerCase(),t["on"+e])})}},{key:"cancelAnimation",value:function(){this.animateIds=this.animateIds||[],this.animateIds.forEach(function(t){clearTimeout(t)}),this.animateIds=[]}},{key:"animate",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,e=this,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=t;this.cancelAnimation(),this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.strokes.forEach(function(i){return"clear"===i.type?(s+=t,e.animateIds.push(setTimeout(function(){e.context.clearRect(0,0,e.canvas.width,e.canvas.height)},s))):void i.lines.forEach(function(n){s+=t,e.animateIds.push(setTimeout(function(){e._draw(n.start,n.end,i.color,i.size)},s))})}),i&&this.animateIds.push(setTimeout(function(){e.animate(t=10,i,n)},s+t+n)),this.animateIds(setTimeout(function(){e.trigger("animation-end",[t,i,n])},s+t))}},{key:"on",value:function(t,e){return void 0===this.events[t]?console.error("Sketchpad: No such action '"+t+"'"):void this.events[t].push(e)}},{key:"off",value:function(t,e){if(e){var i=this.events[t].indexOf(e);return i!==-1&&this.events[t].splice(i,1),i!==-1}this.events[t]=[]}},{key:"trigger",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.events[t].forEach(function(t){t.apply(void 0,i(e))})}},{key:"dispatch",value:function(t,e){var i=this.events[t];if(!this.disable){if(!i)throw new Error;for(var n=0;n<i.length;n++)i[n].apply(this,[this,e])}}}]),t}();window.Sketchpad=o,t.exports=o}])});